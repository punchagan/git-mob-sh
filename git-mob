#!/usr/bin/env bash
set -euo pipefail
IFS=$'\n\t'

COAUTHORS=~/.git-coauthors
TEMPLATE=~/.gitmessage

list () {
    jq -r '.coauthors | to_entries | .[] | "\(.key): \(.value.name) <\(.value.email)>"' "${COAUTHORS}"
}

choose_co_authors () {
    for each in $@; do
        jq -r '.coauthors' "${COAUTHORS}" | jq -r ".${each}"| jq -r '"Co-authored-by: \(.name) <\(.email)>"'
    done
}

create_template () {
    touch "${TEMPLATE}"
    cat <<EOF > ${TEMPLATE}


$(choose_co_authors $@)
EOF
}

enable () {
    create_template $@
    git config --local commit.template "${TEMPLATE}"
}

solo () {
    rm "${TEMPLATE}"
    git config --local --unset commit.template
}

del_co_author () {
    PATTERN="del(.coauthors.${1})"
    jq $PATTERN "${COAUTHORS}" > /tmp/git-coauthors
    mv /tmp/git-coauthors "${COAUTHORS}"
}
